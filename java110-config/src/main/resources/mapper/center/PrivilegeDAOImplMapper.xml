<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="privilegeDAOImpl">
    <select id="queryUserDefaultPrivilege" parameterType="map" resultType="map">
        SELECT a.`p_id` pId,a.`privilege_flag` privilegeFlag,a.`user_id` userId FROM p_privilege_user a WHERE a.`p_id` = #{pId}
        AND a.`user_id` = #{userId}
        AND a.`privilege_flag` = '1'
        AND a.`status_cd` = '0'
    </select>

    <!-- 保存属性信息 c_business_attrs -->
    <insert id="saveUserDefaultPrivilege" parameterType="Map">
        <![CDATA[
            INSERT INTO p_privilege_user(p_id,privilege_flag,user_id) VALUES(#{pId},'1',#{userId})
        ]]>
    </insert>

    <!-- 删除用户所有权限-->
    <update id="deleteUserAllPrivilege" parameterType="Map">
        UPDATE p_privilege_user a SET a.`status_cd` = '1' WHERE a.`user_id` = #{userId}
    </update>

    <insert id="savePrivilegeGroup" parameterType="map">
        INSERT INTO p_privilege_group(pg_id,`name`,description,store_id,domain)
        VALUES(#{pgId},#{name},#{description},#{storeId},#{storeTypeCd})
    </insert>
    <!-- 删除权限组 -->
    <update id="deletePrivilegeGroup" parameterType="Map">
        UPDATE p_privilege_group a SET a.`status_cd` = '1'
        WHERE 1= 1
        <if test="storeId != null and storeId != ''">
            and a.store_id = #{storeId}
        </if>
        and a.pg_id = #{pgId}
        <if test="storeTypeCd != null and storeTypeCd != ''">
            and a.domain= #{storeTypeCd}
        </if>

    </update>

    <!-- 删除权限组 -->
    <update id="deletePrivilegeRel" parameterType="Map">
        UPDATE p_privilege_rel a SET a.`status_cd` = '1'
        WHERE 1=1
        <if test="pgId != null and pgId != ''">
            and a.`pg_id` = #{pgId}
        </if>
        <if test="pId != null and pId != ''">
            and a.`p_id` = #{pId}
        </if>
    </update>

    <select id="queryPrivilegeRel" parameterType="Map" resultType="Map">
        SELECT
            pp.`name`,
            pp.`domain`,
            pp.`p_id` pId,
            pp.`description`,
            pp.`create_time` createTime
        FROM
            p_privilege pp,
            p_privilege_rel ppr
        WHERE ppr.`p_id` = pp.`p_id`
            AND ppr.`status_cd` = '0'
            AND pp.`status_cd` = '0'
            AND ppr.`pg_id` = #{pgId}

    </select>

    <select id="queryPrivilegeGroup" parameterType="Map" resultType="Map">
        select ppg.pg_id pgId,ppg.name,ppg.description,ppg.create_time createTime,ppg.store_id storeId,ppg.domain
        from p_privilege_group ppg
        where 1=1
        <if test="pgId !=null and pgId !=''">
            and ppg.pg_id = #{pgId}
        </if>
        <if test="storeId != null and storeId != ''">
            and ppg.store_id = #{storeId}
        </if>
        <if test="storeTypeCd != null and storeTypeCd != ''">
            and ppg.domain = #{storeTypeCd}
        </if>
        and ppg.status_cd = '0'

    </select>

    <insert id="addPrivilegeRel" parameterType="Map">
        insert into p_privilege_rel(p_id,pg_id)
        values(#{pId},#{pgId})
    </insert>
</mapper>
